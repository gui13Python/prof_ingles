<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chatbot Professor de Inglês</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon-512.png">
  <meta name="theme-color" content="#4CAF50">

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', Arial, sans-serif;
      background: linear-gradient(135deg, #74ebd5, #ACB6E5);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: #333;
    }
    .container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      padding: 30px;
      max-width: 500px;
      width: 90%;
      text-align: center;
      box-sizing: border-box;
    }
    h1 {
      text-align: center;
      color: #2e7d32;
      margin-bottom: 15px;
    }
    p {
      font-size: 1.1em;
      line-height: 1.6;
      margin-bottom: 25px;
    }
    .button-group {
      display: flex;
      flex-direction: column;
      gap: 10px; /* Espaço entre os botões */
      margin-top: 20px;
    }
    .speak-button, .mic-button {
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 1em;
      transition: background-color 0.3s ease;
    }
    .speak-button:hover, .mic-button:hover {
      background-color: #0056b3;
    }
    .mic-button {
      background-color: #28a745; /* Cor verde para o botão do microfone */
    }
    .mic-button:hover {
      background-color: #218838;
    }
    #recognizedText {
      margin-top: 15px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #f9f9f9;
      min-height: 50px;
      text-align: left;
      word-wrap: break-word; /* Garante que o texto não exceda a largura */
    }
    @media (max-width: 600px) {
      h1 {
        font-size: 1.8em;
      }
      p {
        font-size: 1em;
      }
      .container {
        padding: 20px;
      }
    }
  </style>

  <script>
    // Service Worker registration for PWA capabilities
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log('Service Worker registrado com sucesso!'))
        .catch(error => console.log('Falha ao registrar Service Worker:', error));
    }

    // Função para Síntese de Fala (Text-to-Speech)
    function speakText(text) {
      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'pt-BR'; // Define o idioma para Português do Brasil
        window.speechSynthesis.speak(utterance);
      } else {
        console.warn('A API de Síntese de Fala não é suportada neste navegador.');
        // Substituindo alert() por uma mensagem na console para evitar bloqueios
        console.log('Seu navegador não suporta a função de leitura em voz alta.');
      }
    }

    // Função para ler o conteúdo do container
    function readWelcomeMessage() {
      const welcomeHeading = document.querySelector('.container h1').innerText;
      const welcomeParagraphs = Array.from(document.querySelectorAll('.container p')).map(p => p.innerText).join(' ');
      const fullText = `${welcomeHeading}. ${welcomeParagraphs}`;
      speakText(fullText);
    }

    // --- Funcionalidade de Reconhecimento de Voz (Speech-to-Text) ---
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;
    let recognizing = false;

    if (SpeechRecognition) {
      recognition = new SpeechRecognition();
      recognition.continuous = false; // Define para capturar uma única frase
      recognition.interimResults = false; // Não mostra resultados provisórios
      recognition.lang = 'pt-BR'; // Define o idioma para Português do Brasil

      recognition.onstart = () => {
        recognizing = true;
        document.getElementById('micButton').textContent = 'A Ouvir... (Clique para parar)';
        document.getElementById('micButton').style.backgroundColor = '#dc3545'; // Cor de gravação (vermelho)
        console.log('Reconhecimento de voz iniciado.');
      };

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById('recognizedText').textContent = `Você disse: "${transcript}"`;
        // Aqui você pode adicionar lógica para enviar 'transcript' para o chatbot Botpress
        // Exemplo (conceitual, depende da API do Botpress):
        // botpressChatWidget.sendMessage(transcript);
        console.log('Texto reconhecido:', transcript);
      };

      recognition.onerror = (event) => {
        recognizing = false;
        document.getElementById('micButton').textContent = 'Falar para o Chat';
        document.getElementById('micButton').style.backgroundColor = '#28a745';
        document.getElementById('recognizedText').textContent = 'Erro no reconhecimento de voz: ' + event.error;
        console.error('Erro no reconhecimento de voz:', event.error);
      };

      recognition.onend = () => {
        recognizing = false;
        document.getElementById('micButton').textContent = 'Falar para o Chat';
        document.getElementById('micButton').style.backgroundColor = '#28a745';
        console.log('Reconhecimento de voz terminado.');
      };
    } else {
      console.warn('A API de Reconhecimento de Fala não é suportada neste navegador.');
      document.addEventListener('DOMContentLoaded', () => {
        const micButton = document.getElementById('micButton');
        if (micButton) {
          micButton.style.display = 'none'; // Esconde o botão se a API não for suportada
        }
      });
    }

    function toggleSpeechRecognition() {
      if (recognizing) {
        recognition.stop();
      } else {
        document.getElementById('recognizedText').textContent = 'Aguardando sua fala...';
        recognition.start();
      }
    }

    // Adiciona listeners para os botões após o carregamento do DOM
    document.addEventListener('DOMContentLoaded', () => {
      const speakButton = document.getElementById('speakWelcome');
      if (speakButton) {
        speakButton.addEventListener('click', readWelcomeMessage);
      }

      const micButton = document.getElementById('micButton');
      if (micButton && SpeechRecognition) { // Garante que o botão só tenha o listener se a API estiver disponível
        micButton.addEventListener('click', toggleSpeechRecognition);
      }
    });

  </script>
</head>
<body>

  <div class="container">
    <h1>Bem-vindo ao seu Professor de Inglês!</h1>
    <p>Clique no ícone de chat no canto inferior direito para começar a conversar e melhorar suas habilidades em inglês.</p>
    <p>O seu professor virtual está pronto para ajudar com vocabulário, frases, exercícios e muito mais!</p>

    <div class="button-group">
      <button id="speakWelcome" class="speak-button">Ouvir Mensagem de Boas-Vindas</button>
      <button id="micButton" class="mic-button">Falar para o Chat</button>
    </div>

    <div id="recognizedText"></div> <!-- Área para exibir o texto reconhecido -->
  </div>

  <!-- Botpress Chatbot Integration -->
  <script src="https://cdn.botpress.cloud/webchat/v3.0/inject.js"></script>
  <script src="https://files.bpcontent.cloud/2025/06/22/17/20250622172651-6U5NWWQ0.js"></script>

</body>
</html>
